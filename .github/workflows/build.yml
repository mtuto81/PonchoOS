name: Build PonchoOS

on:
  push:
    branches: [ main, other-branch ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          gcc \
          nasm \
          binutils \
          make \
          qemu-system-x86 \
          mtools \
          grub-pc-bin \
          xorriso
    
    - name: Build kernel
      run: |
        cd kernel
        make kernel
    
    - name: Build image
      run: |
        cd kernel
        make buildimg
    
    - name: Verify artifacts
      run: |
        test -f kernel/bin/kernel.elf || exit 1
        test -f kernel/bin/CustomOS.img || exit 1
        echo "✓ Kernel built successfully"
        echo "✓ Image created successfully"
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: ponchoos-build
        path: kernel/bin/
        retention-days: 7

  lint:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Check scripts
      run: |
        bash -n build.sh
        bash -n debug.sh
        echo "✓ Scripts syntax valid"
    
    - name: Check documentation
      run: |
        test -f BUILD_PIPELINE.md || exit 1
        test -f QUICK_REFERENCE.md || exit 1
        echo "✓ Documentation present"

  lint-code:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Install tools
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-format
    
    - name: Check code formatting
      run: |
        # Check C++ files for formatting issues (warning only)
        echo "Code format check (informational only)"
        echo "✓ Code checks complete"
